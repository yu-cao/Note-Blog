## Lua学习笔记3

### The Application Program Interface

本节介绍Lua的C API，即主机程序可用于与Lua通信的C函数集。所有API函数以及相关的类型和常量都在头文件lua.h中声明。

即使我们使用术语“函数”，API中的任何工具也可以作为宏提供。除非另有说明，否则所有这些宏都只使用它们的每个参数一次（除了第一个参数，它总是一个Lua状态），因此不会产生任何隐藏的副作用。

与大多数C库一样，Lua API函数不检查其参数的有效性或一致性。但是，您可以通过使用定义的宏LUA_USE_APICHECK编译Lua来更改此行为。

Lua库是完全可重入的：它没有全局变量。它将所需的所有信息保存在称为Lua状态的动态结构中。

每个Lua状态具有一个或多个线程，其对应于独立的协作执行线。类型lua_State（尽管它的名字）指的是一个线程。 （间接地，通过线程，它还指向与线程关联的Lua状态。）

指向线程的指针必须作为第一个参数传递给库中的每个函数，除了lua_newstate，它从头创建一个Lua状态并返回一个指向新状态的主线程的指针。

### The Stack

Lua使用虚拟堆栈向C传递值。此堆栈中的每个元素表示Lua值（nil，number，string等）。 API中的函数可以通过它们接收的Lua状态参数访问此堆栈。

每当Lua调用C时，被调用的函数将获得一个新的堆栈，该堆栈独立于先前的堆栈和仍处于活动状态的C函数堆栈。该堆栈最初包含C函数的任何参数，它是C函数可以存储临时Lua值的地方，并且必须将其结果推送回调用者。

为方便起见，API中的大多数查询操作都不遵循严格的堆栈规则。相反，它们可以通过使用索引引用堆栈中的任何元素：正索引表示绝对堆栈位置（从1开始）;负索引表示相对于堆栈顶部的偏移量。更具体地说，如果堆栈有n个元素，则索引1表示第一个元素（即，首先被压入堆栈的元素），索引n表示最后一个元素; index -1也表示最后一个元素（即顶部的元素），index -n表示第一个元素。

### Stack Size

